<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üöÄ AlphaGenesis Î∞±ÌÖåÏä§Ìä∏ ÎåÄÏãúÎ≥¥Îìú</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <!-- Date Range Picker -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --dark-bg: #0a0e1a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 0 auto;
            max-width: 1400px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .header h1 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .settings-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        
        .settings-panel h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #20c997 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #fd7e14 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 193, 7, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .status-display {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .status-ready {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        .status-error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        
        .status-loading {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .results-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        
        .results-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }
        
        .stat-value {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
        }
        
        .positive { color: var(--success-color); }
        .negative { color: var(--danger-color); }
        .neutral { color: var(--warning-color); }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .chart-container h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .trades-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }
        
        .trades-container h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table th {
            background: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
        }
        
        .table td {
            vertical-align: middle;
            color: #495057;
        }
        
        .progress-container {
            margin-top: 15px;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
        }
        
        .progress-bar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 4px;
        }
        
        .error-display {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(220, 53, 69, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .results-placeholder {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
            font-size: 18px;
            background: white;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .param-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .param-group {
            display: flex;
            flex-direction: column;
        }
        
        .param-group label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .param-group input {
            border-radius: 6px;
            border: 1px solid #ced4da;
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .param-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .data-period {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
            border: 1px solid rgba(23, 162, 184, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> AlphaGenesis Î∞±ÌÖåÏä§Ìä∏ ÎåÄÏãúÎ≥¥Îìú</h1>
            <p>Îã§ÏñëÌïú Ï†ÑÎûµÏúºÎ°ú Î∞±ÌÖåÏä§Ìä∏Î•º Ïã§ÌñâÌïòÍ≥† Ïã§ÏãúÍ∞ÑÏúºÎ°ú Í≤∞Í≥ºÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="settings-panel">
            <h3><i class="fas fa-cog"></i> Î∞±ÌÖåÏä§Ìä∏ ÏÑ§Ï†ï</h3>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Í∏∞Í∞Ñ ÏÑ§Ï†ï</label>
                        <input type="text" id="dateRange" class="form-control" placeholder="ÎÇ†Ïßú Î≤îÏúÑÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Ïã¨Î≥º</label>
                        <select id="symbolSelect" class="form-select" disabled>
                            <option value="BTC_USDT">BTC/USDT</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Ï†ÑÎûµ</label>
                        <select id="strategySelect" class="form-select" disabled>
                            <option value="CVD_0.01">CVD 0.01% Ï†ÑÎûµ</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Ï¥àÍ∏∞ ÏûêÎ≥∏</label>
                        <input type="number" id="initialCapital" class="form-control" value="10000000" min="1000" step="1000">
                    </div>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <button id="downloadBtn" class="btn btn-primary w-100">
                        <i class="fas fa-download"></i> 1. Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú
                    </button>
                </div>
                <div class="col-md-6">
                    <button id="backtestBtn" class="btn btn-success w-100" disabled>
                        <i class="fas fa-play"></i> 2. Î∞±ÌÖåÏä§Ìä∏ ÏãúÏûë
                    </button>
                </div>
            </div>
            
            <div id="statusDisplay" class="status-display" style="display: none;"></div>
            <div id="progressContainer" class="progress-container" style="display: none;">
                <div class="progress">
                    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <small class="text-muted mt-2" id="progressText">0%</small>
            </div>
        </div>

        <div id="errorDisplay" class="error-display" style="display: none;"></div>

        <div id="resultsContainer" class="results-container" style="display: none;">
            <h3><i class="fas fa-chart-bar"></i> Î∞±ÌÖåÏä§Ìä∏ Í≤∞Í≥º</h3>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Ï¥ù ÏàòÏùµÎ•†</span>
                    <span id="totalReturn" class="stat-value">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏäπÎ•†</span>
                    <span id="winRate" class="stat-value">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏµúÎåÄ ÎÇôÌè≠ (MDD)</span>
                    <span id="maxDrawdown" class="stat-value">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏÉ§ÌîÑ ÏßÄÏàò</span>
                    <span id="sharpeRatio" class="stat-value">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ï¥ù Í±∞Îûò ÌöüÏàò</span>
                    <span id="totalTrades" class="stat-value">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ÏµúÏ¢Ö ÏûêÎ≥∏</span>
                    <span id="finalCapital" class="stat-value">-</span>
                </div>
            </div>
            
            <div class="chart-container">
                <h4><i class="fas fa-chart-area"></i> ÏûêÏÇ∞ Í≥°ÏÑ†</h4>
                <div id="equityChart" style="height: 400px;"></div>
            </div>
        </div>

        <div id="tradesContainer" class="trades-container" style="display: none;">
            <h4><i class="fas fa-list"></i> Îß§Îß§ Î°úÍ∑∏</h4>
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ÎÇ†Ïßú</th>
                            <th>ÏãúÍ∞Ñ</th>
                            <th>Ïã¨Î≥º</th>
                            <th>ÌñâÎèô</th>
                            <th>ÏàòÎüâ</th>
                            <th>Í∞ÄÍ≤©</th>
                            <th>Í±∞ÎûòÍ∏àÏï°</th>
                            <th>ÏàòÏàòÎ£å</th>
                            <th>ÏÜêÏùµ</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTableBody">
                        <!-- Îß§Îß§ Î°úÍ∑∏Í∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let chart = null;
        let downloadedData = null;
        let dataStatus = 'idle'; // 'idle', 'downloading', 'ready', 'error'
        let backtestRunning = false;
        
        // Ï†ÑÎûµÎ≥Ñ Í∏∞Î≥∏ ÌååÎùºÎØ∏ÌÑ∞
        const strategyParams = {
            'SmaCross': [
                { name: 'pfast', label: 'Îã®Í∏∞ MA', default: 10, min: 1, max: 50 },
                { name: 'pslow', label: 'Ïû•Í∏∞ MA', default: 30, min: 5, max: 200 }
            ],
            'RSI': [
                { name: 'period', label: 'Í∏∞Í∞Ñ', default: 14, min: 5, max: 50 },
                { name: 'upper', label: 'ÏÉÅÎã®ÏÑ†', default: 70, min: 50, max: 90 },
                { name: 'lower', label: 'ÌïòÎã®ÏÑ†', default: 30, min: 10, max: 50 }
            ],
            'BollingerBands': [
                { name: 'period', label: 'Í∏∞Í∞Ñ', default: 20, min: 5, max: 50 },
                { name: 'devfactor', label: 'ÌëúÏ§ÄÌé∏Ï∞® Î∞∞Ïàò', default: 2, min: 1, max: 3 }
            ],
            'MACD': [
                { name: 'fast_period', label: 'Îπ†Î•∏ Í∏∞Í∞Ñ', default: 12, min: 5, max: 50 },
                { name: 'slow_period', label: 'ÎäêÎ¶∞ Í∏∞Í∞Ñ', default: 26, min: 10, max: 100 },
                { name: 'signal_period', label: 'ÏãúÍ∑∏ÎÑê Í∏∞Í∞Ñ', default: 9, min: 5, max: 30 }
            ],
            'TripleCombo': []
        };
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeDateRangePicker();
            loadDataInfo();
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
            document.getElementById('strategySelect').addEventListener('change', updateParamInputs);
            document.getElementById('downloadBtn').addEventListener('click', downloadData);
            document.getElementById('backtestBtn').addEventListener('click', runBacktest);
        });
        
        // ÎÇ†Ïßú Î≤îÏúÑ ÏÑ†ÌÉùÍ∏∞ Ï¥àÍ∏∞Ìôî
        function initializeDateRangePicker() {
            $('#dateRange').daterangepicker({
                startDate: moment().subtract(1, 'year'),
                endDate: moment(),
                locale: {
                    format: 'YYYY-MM-DD',
                    applyLabel: 'Ï†ÅÏö©',
                    cancelLabel: 'Ï∑®ÏÜå',
                    fromLabel: 'Î∂ÄÌÑ∞',
                    toLabel: 'ÍπåÏßÄ',
                    customRangeLabel: 'ÏÇ¨Ïö©Ïûê Ï†ïÏùò',
                    daysOfWeek: ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'],
                    monthNames: ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî']
                }
            });
        }
        
        // Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥ Î°úÎìú
        function loadDataInfo() {
            fetch('/api/data/info')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showError(data.error);
                        return;
                    }
                    
                    // Ïã¨Î≥º ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏
                    const symbolSelect = document.getElementById('symbolSelect');
                    symbolSelect.innerHTML = '';
                    data.symbols.forEach(symbol => {
                        const option = document.createElement('option');
                        option.value = symbol;
                        option.textContent = symbol.replace('_', '/');
                        symbolSelect.appendChild(option);
                    });
                    
                    // Îç∞Ïù¥ÌÑ∞ Í∏∞Í∞Ñ Ï†ïÎ≥¥ ÌëúÏãú
                    if (data.start_date && data.end_date) {
                        const periodInfo = document.createElement('div');
                        periodInfo.className = 'data-period';
                        periodInfo.innerHTML = `<strong>Î∞±ÌÖåÏä§Ìä∏ Í∞ÄÎä• Í∏∞Í∞Ñ:</strong> ${data.start_date} ~ ${data.end_date}`;
                        document.querySelector('.settings-panel').appendChild(periodInfo);
                    }
                })
                .catch(error => {
                    console.error('Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥ Î°úÎìú Ïò§Î•ò:', error);
                    showError('Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                });
        }
        
        // ÌååÎùºÎØ∏ÌÑ∞ ÏûÖÎ†• ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateParamInputs() {
            const strategy = document.getElementById('strategySelect').value;
            const container = document.getElementById('paramInputs');
            container.innerHTML = '';
            
            const params = strategyParams[strategy] || [];
            params.forEach(param => {
                const paramGroup = document.createElement('div');
                paramGroup.className = 'param-group';
                
                const label = document.createElement('label');
                label.textContent = param.label;
                
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `param_${param.name}`;
                input.value = param.default;
                input.min = param.min;
                input.max = param.max;
                
                paramGroup.appendChild(label);
                paramGroup.appendChild(input);
                container.appendChild(paramGroup);
            });
        }
        
        // Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú
        function downloadData() {
            const dateRange = $('#dateRange').data('daterangepicker');
            const symbol = 'BTC_USDT';
            if (!dateRange.startDate || !dateRange.endDate) {
                showError('ÎÇ†Ïßú Î≤îÏúÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            setDataStatus('downloading');
            showProgress();
            const params = new URLSearchParams({
                symbol: symbol,
                start_date: dateRange.startDate.format('YYYY-MM-DD'),
                end_date: dateRange.endDate.format('YYYY-MM-DD')
            });
            fetch(`/api/data/download?${params}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        setDataStatus('error');
                        showError(data.error);
                        return;
                    }
                    downloadedData = data;
                    setDataStatus('ready');
                    hideProgress();
                    document.getElementById('backtestBtn').disabled = false;
                    showStatus(`‚úÖ Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú ÏôÑÎ£å (${data.data_points}Í∞ú Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏)`, 'ready');
                })
                .catch(error => {
                    console.error('Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú Ïò§Î•ò:', error);
                    setDataStatus('error');
                    hideProgress();
                    showError('Îç∞Ïù¥ÌÑ∞ Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                });
        }
        
        // Î∞±ÌÖåÏä§Ìä∏ Ïã§Ìñâ
        function runBacktest() {
            if (dataStatus !== 'ready' || !downloadedData) {
                showError('Î®ºÏ†Ä Îç∞Ïù¥ÌÑ∞Î•º Îã§Ïö¥Î°úÎìúÌï¥Ïïº Ìï©ÎãàÎã§.');
                return;
            }
            const dateRange = $('#dateRange').data('daterangepicker');
            const symbol = 'BTC_USDT';
            const strategy = 'CVD_0.01';
            const initialCapital = parseFloat(document.getElementById('initialCapital').value);
            const config = {
                symbol: symbol,
                strategy: strategy,
                start_date: dateRange.startDate.format('YYYY-MM-DD'),
                end_date: dateRange.endDate.format('YYYY-MM-DD'),
                initial_capital: initialCapital,
                params: {}
            };
            backtestRunning = true;
            document.getElementById('backtestBtn').disabled = true;
            document.getElementById('downloadBtn').disabled = true;
            showProgress();
            showStatus('Î∞±ÌÖåÏä§Ìä∏ Ïã§Ìñâ Ï§ë...', 'loading');
            simulateBacktest(config);
        }
        
        // Î∞±ÌÖåÏä§Ìä∏ ÏãúÎÆ¨Î†àÏù¥ÏÖò (Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤ÑÏóêÏÑú Ïã§Ìñâ)
        function simulateBacktest(config) {
            const totalSteps = downloadedData.ohlcv.length;
            let currentStep = 0;
            let mockCapital = config.initial_capital;
            const equityCurve = [];
            
            function runStep() {
                if (currentStep >= totalSteps || !backtestRunning) {
                    // Î∞±ÌÖåÏä§Ìä∏ ÏôÑÎ£å
                    backtestRunning = false;
                    document.getElementById('backtestBtn').disabled = false;
                    document.getElementById('downloadBtn').disabled = false;
                    hideProgress();
                    showStatus('Î∞±ÌÖåÏä§Ìä∏ ÏôÑÎ£å!', 'ready');
                    return;
                }
                
                // Í∞ÄÏßú ÏûêÎ≥∏ Î≥ÄÎèô (Ïã§Ï†úÎ°úÎäî Ï†ÑÎûµÏóê Îî∞Îùº Í≥ÑÏÇ∞)
                const volatility = 0.01; // 1% Î≥ÄÎèôÏÑ±
                const change = (Math.random() - 0.5) * volatility;
                mockCapital *= (1 + change);
                
                const currentDataPoint = downloadedData.ohlcv[currentStep];
                equityCurve.push({
                    time: currentDataPoint.time,
                    value: mockCapital
                });
                
                // ÏßÑÌñâÏÉÅÌô© ÏóÖÎç∞Ïù¥Ìä∏
                const progress = (currentStep / totalSteps) * 100;
                updateProgress(progress);
                
                // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (100Í∞ú Ìè¨Ïù∏Ìä∏ÎßàÎã§)
                if (currentStep % Math.max(1, Math.floor(totalSteps / 100)) === 0) {
                    updateEquityChart(equityCurve);
                    updateResults({
                        total_return: ((mockCapital - config.initial_capital) / config.initial_capital * 100).toFixed(2),
                        win_rate: (Math.random() * 30 + 50).toFixed(2),
                        max_drawdown: (Math.random() * 10 + 5).toFixed(2),
                        sharpe_ratio: (Math.random() * 1.5).toFixed(2),
                        total_trades: Math.floor(currentStep / 10),
                        final_capital: mockCapital.toFixed(2)
                    });
                }
                
                currentStep++;
                setTimeout(runStep, 10); // 10ms Í∞ÑÍ≤©ÏúºÎ°ú Ïã§Ìñâ
            }
            
            runStep();
        }
        
        // ÏûêÏÇ∞ Í≥°ÏÑ† Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateEquityChart(data) {
            if (!chart) {
                const chartContainer = document.getElementById('equityChart');
                chart = LightweightCharts.createChart(chartContainer, {
                    width: chartContainer.clientWidth,
                    height: 400,
                    layout: {
                        textColor: '#333',
                        background: { type: 'solid', color: '#ffffff' }
                    },
                    grid: {
                        vertLines: { color: '#f0f0f0' },
                        horzLines: { color: '#f0f0f0' }
                    },
                    timeScale: {
                        timeVisible: true,
                        secondsVisible: false
                    }
                });
                
                const areaSeries = chart.addAreaSeries({
                    topColor: 'rgba(102, 126, 234, 0.56)',
                    bottomColor: 'rgba(102, 126, 234, 0.04)',
                    lineColor: 'rgba(102, 126, 234, 1)',
                    lineWidth: 2
                });
                
                chart.areaSeries = areaSeries;
            }
            
            if (data.length > 0) {
                chart.areaSeries.setData(data);
                chart.timeScale().fitContent();
            }
        }
        
        // Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
        function updateResults(results) {
            document.getElementById('totalReturn').textContent = results.total_return + '%';
            document.getElementById('winRate').textContent = results.win_rate + '%';
            document.getElementById('maxDrawdown').textContent = results.max_drawdown + '%';
            document.getElementById('sharpeRatio').textContent = results.sharpe_ratio;
            document.getElementById('totalTrades').textContent = results.total_trades;
            document.getElementById('finalCapital').textContent = '$' + parseFloat(results.final_capital).toLocaleString();
            
            // ÏÉâÏÉÅ Ï†ÅÏö©
            document.getElementById('totalReturn').className = 'stat-value ' + (parseFloat(results.total_return) >= 0 ? 'positive' : 'negative');
            
            // Í≤∞Í≥º Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            document.getElementById('resultsContainer').style.display = 'block';
        }
        
        // Îß§Îß§ Î°úÍ∑∏ ÏóÖÎç∞Ïù¥Ìä∏ (ÎçîÎØ∏ Îç∞Ïù¥ÌÑ∞)
        function updateTradeLogs() {
            const tbody = document.getElementById('tradesTableBody');
            tbody.innerHTML = '';
            
            // ÎçîÎØ∏ Îß§Îß§ Î°úÍ∑∏ ÏÉùÏÑ±
            const mockTrades = [
                { date: '2023-01-15', time: '10:30:00', symbol: 'BTC/USDT', action: 'BUY', size: 0.1, price: '30000.00', value: '3000.00', commission: '3.00', pnl: '' },
                { date: '2023-01-20', time: '14:45:00', symbol: 'BTC/USDT', action: 'SELL', size: 0.1, price: '31000.00', value: '3100.00', commission: '3.10', pnl: '+100.00' },
                { date: '2023-02-01', time: '09:15:00', symbol: 'BTC/USDT', action: 'BUY', size: 0.15, price: '30500.00', value: '4575.00', commission: '4.58', pnl: '' },
                { date: '2023-02-10', time: '16:20:00', symbol: 'BTC/USDT', action: 'SELL', size: 0.15, price: '32000.00', value: '4800.00', commission: '4.80', pnl: '+225.00' }
            ];
            
            mockTrades.forEach(trade => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trade.date}</td>
                    <td>${trade.time}</td>
                    <td>${trade.symbol}</td>
                    <td><span class="badge ${trade.action === 'BUY' ? 'bg-success' : 'bg-danger'}">${trade.action}</span></td>
                    <td>${trade.size}</td>
                    <td>$${trade.price}</td>
                    <td>$${trade.value}</td>
                    <td>$${trade.commission}</td>
                    <td class="${trade.pnl ? (parseFloat(trade.pnl) >= 0 ? 'text-success' : 'text-danger') : ''}">${trade.pnl || '-'}</td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('tradesContainer').style.display = 'block';
        }
        
        // ÏÉÅÌÉú ÌëúÏãú
        function setDataStatus(status) {
            dataStatus = status;
        }
        
        function showStatus(message, type) {
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.textContent = message;
            statusDisplay.className = `status-display status-${type}`;
            statusDisplay.style.display = 'block';
        }
        
        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
        }
        
        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
        }
        
        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = Math.round(percent) + '%';
        }
        
        function showError(message) {
            const errorDisplay = document.getElementById('errorDisplay');
            errorDisplay.textContent = message;
            errorDisplay.style.display = 'block';
            
            setTimeout(() => {
                errorDisplay.style.display = 'none';
            }, 5000);
        }
        
        // Ï∞Ω ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú Ï∞®Ìä∏ Î¶¨ÏÇ¨Ïù¥Ï¶à
        window.addEventListener('resize', function() {
            if (chart) {
                chart.applyOptions({ width: document.getElementById('equityChart').clientWidth });
            }
        });
    </script>
</body>
</html>

