<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaGenesis - Professional Backtesting</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066FF;
            --primary-light: #3D8BFF;
            --primary-dark: #0052CC;
            --success: #00D084;
            --warning: #FFB800;
            --danger: #FF4757;
            --dark: #1A1D29;
            --dark-light: #252836;
            --dark-lighter: #2F3349;
            --text-primary: #FFFFFF;
            --text-secondary: #8B8FA3;
            --text-muted: #6C7293;
            --border: #3A3F5C;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --glow: 0 0 20px rgba(0, 102, 255, 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0F0F1E 0%, #1A1D29 50%, #252836 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, var(--primary) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, var(--success) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, var(--warning) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(20px);
            background: rgba(26, 29, 41, 0.9);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem 2rem;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo i {
            color: var(--primary);
            filter: drop-shadow(0 0 10px var(--primary));
        }

        .nav-items {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--text-primary);
            background: var(--glass);
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 120px);
        }

        /* Control Panel */
        .control-panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 2rem;
            height: fit-content;
            position: sticky;
            top: 120px;
            box-shadow: var(--shadow);
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title i {
            color: var(--primary);
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        /* Strategy Toggle */
        .strategy-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .strategy-btn {
            padding: 0.75rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .strategy-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            box-shadow: var(--glow);
        }

        /* Period Selector */
        .period-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .period-btn {
            padding: 0.5rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .period-btn.active {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Capital Input */
        .capital-input {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .capital-presets {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .capital-preset {
            padding: 0.375rem 0.25rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-muted);
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .capital-preset:hover {
            background: var(--primary);
            color: white;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 4px 20px rgba(0, 102, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 102, 255, 0.4);
        }

        .btn-secondary {
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Results Header */
        .results-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .results-actions {
            display: flex;
            gap: 1rem;
        }

        .results-btn {
            padding: 0.5rem 1rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .results-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Performance Cards */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .performance-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .performance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--success));
        }

        .performance-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .card-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(0, 208, 132, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(255, 184, 0, 0.2);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(255, 71, 87, 0.2);
            color: var(--danger);
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .card-change {
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        /* Chart Container */
        .chart-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            height: 500px;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-btn {
            padding: 0.375rem 0.75rem;
            background: var(--dark-lighter);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Strategy Comparison Table */
        .comparison-table {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
        }

        .table-header {
            background: var(--dark-lighter);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
        }

        .table-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-content {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .strategy-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .strategy-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
        }

        .metric-value {
            font-weight: 600;
        }

        /* Status Indicator */
        .status-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.75rem 1rem;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.875rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Progress Bar */
        .progress-container {
            margin: 1.5rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--dark-lighter);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 280px 1fr;
                gap: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .control-panel {
                position: static;
                order: 2;
            }
            
            .main-content {
                order: 1;
            }
            
            .performance-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                padding: 0 1rem;
            }
            
            .nav-items {
                gap: 1rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Backtest Monitor Styles */
        .backtest-monitor {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            margin-bottom: 2rem;
            overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .monitor-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        .monitor-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .monitor-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .monitor-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .monitor-content {
            padding: 2rem;
        }

        .monitor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 1.5rem;
        }

        .monitor-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .monitor-logs {
            grid-column: 1 / -1;
        }

        .monitor-card-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .monitor-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 0.25rem;
        }

        .stat-value.positive { color: var(--success); }
        .stat-value.negative { color: var(--danger); }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .trade-log-container {
            max-height: 200px;
            overflow-y: auto;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .trade-log-empty {
            text-align: center;
            color: var(--text-muted);
            padding: 2rem;
            font-style: italic;
        }

        .trade-log-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .trade-log-item.buy {
            background: rgba(0, 208, 132, 0.1);
            border-left: 3px solid var(--success);
        }

        .trade-log-item.sell {
            background: rgba(255, 71, 87, 0.1);
            border-left: 3px solid var(--danger);
        }

        .trade-log-symbol {
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .trade-log-action {
            font-weight: 600;
            text-transform: uppercase;
        }

        .trade-log-action.buy { color: var(--success); }
        .trade-log-action.sell { color: var(--danger); }

        .trade-log-price {
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem;
            background: var(--dark);
            color: var(--text-primary);
            font-size: 0.75rem;
            border-radius: 6px;
            white-space: nowrap;
            z-index: 1000;
        }

        /* 백테스트 미실행 시 숨김 */
        .backtest-results {
            display: none;
        }

        .backtest-results.show {
            display: block;
        }

        /* 초기 상태 메시지 */
        .no-results-message {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            margin: 2rem 0;
        }

        .no-results-message i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .no-results-message h3 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        /* 드롭다운 심볼 선택 스타일 */
        .symbol-dropdown-container {
            position: relative;
        }

        .symbol-dropdown-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .symbol-dropdown-trigger:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .symbol-dropdown-trigger.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 102, 255, 0.2);
        }

        .selected-text {
            color: var(--text-primary);
            font-weight: 500;
        }

        .dropdown-arrow {
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .symbol-dropdown-trigger.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .symbol-dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: rgba(37, 45, 66, 0.98);
            backdrop-filter: blur(20px);
            border: 2px solid var(--primary);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            max-height: 450px;
            overflow: visible;
            min-width: 100%;
        }

        .symbol-search-container {
            position: relative;
            padding: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .search-icon {
            position: absolute;
            right: 1.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .symbol-actions {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .symbol-action-btn {
            flex: 1;
            padding: 0.5rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .symbol-action-btn:hover {
            background: rgba(0, 102, 255, 0.1);
            border-color: var(--primary);
        }

        .symbol-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .symbol-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .symbol-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .symbol-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--glass-border);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .symbol-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .symbol-checkbox.checked::after {
            content: '\\2713';
            position: absolute;
            color: white;
            font-size: 12px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .symbol-text {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .symbol-name {
            color: var(--text-primary);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .symbol-description {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .loading-symbols {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .symbol-info {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Risk Management 스타일 */
        .risk-status {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
        }

        .risk-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .risk-level {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .risk-level.safe {
            background: rgba(0, 208, 132, 0.2);
            color: var(--success);
        }

        .risk-level.moderate {
            background: rgba(255, 184, 0, 0.2);
            color: var(--warning);
        }

        .risk-level.high {
            background: rgba(255, 71, 87, 0.2);
            color: var(--danger);
        }

        .risk-value {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .risk-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        .metric-item {
            text-align: center;
        }

        .metric-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .metric-value {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* 전략 선택 스타일 */
        .strategy-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .strategy-option {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
            min-width: 300px;
        }

        .strategy-option:hover {
            border-color: var(--primary);
            background: rgba(0, 102, 255, 0.05);
        }

        .strategy-checkbox-label {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            cursor: pointer;
            width: 100%;
        }

        .strategy-checkbox {
            width: 18px;
            height: 18px;
            margin-bottom: 0.5rem;
        }

        .strategy-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .strategy-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .strategy-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .strategy-action-btn {
            flex: 1;
            min-width: 100px;
            padding: 0.5rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .strategy-action-btn:hover {
            background: rgba(0, 102, 255, 0.1);
            border-color: var(--primary);
        }

        .strategy-action-btn#runComparisonBtn {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .strategy-action-btn#runComparisonBtn:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <!-- Status Indicator -->
    <div class="status-indicator">
        <div class="status-dot"></div>
        <span>System Online</span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <i class="fas fa-rocket"></i>
                <span>AlphaGenesis</span>
            </a>
            <nav class="nav-items">
                <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/backtest" class="nav-link active">백테스트</a>
                <a href="/live" class="nav-link">실전매매</a>
                <a href="/analytics" class="nav-link"><i class="fas fa-chart-pie"></i> 프리미엄 분석</a>
            </nav>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <h2 class="panel-title">
                <i class="fas fa-cog"></i>
                Backtest Configuration
            </h2>

            <!-- Strategy Selection -->
            <div class="form-group">
                <label class="form-label">백테스트 모드</label>
                <div class="strategy-toggle">
                    <button class="strategy-btn active" data-mode="compare">개별 전략</button>
                    <button class="strategy-btn" data-mode="all">전체 시장</button>
                </div>
            </div>

            <!-- Strategy Selection (4가지 전략) -->
            <div class="form-group" id="strategyGroup">
                <label class="form-label">전략 선택</label>
                <div class="strategy-selection">
                    <div class="strategy-option">
                        <label class="strategy-checkbox-label">
                            <input type="checkbox" class="strategy-checkbox" value="strategy1_basic" checked>
                            <span class="strategy-name">전략 1 (기본)</span>
                            <span class="strategy-desc">1시간봉 급등</span>
                        </label>
                    </div>
                    <div class="strategy-option">
                        <label class="strategy-checkbox-label">
                            <input type="checkbox" class="strategy-checkbox" value="strategy1_alpha" checked>
                            <span class="strategy-name">전략 1-1 (알파)</span>
                            <span class="strategy-desc">1시간봉 급등+α</span>
                        </label>
                    </div>
                    <div class="strategy-option">
                        <label class="strategy-checkbox-label">
                            <input type="checkbox" class="strategy-checkbox" value="strategy2_basic" checked>
                            <span class="strategy-name">전략 2 (기본)</span>
                            <span class="strategy-desc">눌림목 급등</span>
                        </label>
                    </div>
                    <div class="strategy-option">
                        <label class="strategy-checkbox-label">
                            <input type="checkbox" class="strategy-checkbox" value="strategy2_alpha" checked>
                            <span class="strategy-name">전략 2-1 (알파)</span>
                            <span class="strategy-desc">눌림목 급등+α</span>
                        </label>
                    </div>
                </div>
                <div class="strategy-actions">
                    <button type="button" class="strategy-action-btn" id="selectAllStrategies">전체 선택</button>
                    <button type="button" class="strategy-action-btn" id="clearAllStrategies">전체 해제</button>
                    <button type="button" class="strategy-action-btn" id="runComparisonBtn">4전략 비교분석</button>
                </div>
            </div>

            <!-- Symbol Selection -->
            <div class="form-group" id="symbolGroup">
                <label class="form-label">거래 심볼</label>
                <div class="symbol-dropdown-container">
                    <div class="symbol-dropdown-trigger" id="symbolDropdownTrigger">
                        <span class="selected-text">클릭하여 심볼 선택</span>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </div>
                    <div class="symbol-dropdown-menu" id="symbolDropdownMenu" style="display: none;">
                        <div class="symbol-search-container">
                            <input type="text" class="form-input" id="symbolSearch" placeholder="심볼 검색 (예: BTC, ETH)">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="symbol-actions">
                            <button type="button" class="symbol-action-btn" id="selectAllBtn">전체 선택</button>
                            <button type="button" class="symbol-action-btn" id="clearAllBtn">전체 해제</button>
                        </div>
                        <div class="symbol-list" id="symbolList">
                            <div class="loading-symbols">심볼 로딩 중...</div>
                        </div>
                    </div>
                </div>
                <div class="symbol-info">
                    <span id="symbolCount">0</span>개 심볼 선택됨
                </div>
            </div>

            <!-- Time Period -->
            <div class="form-group">
                <label class="form-label">Time Period</label>
                <div class="period-selector">
                    <button class="period-btn" data-period="6m">6M</button>
                    <button class="period-btn" data-period="1y">1Y</button>
                    <button class="period-btn active" data-period="2y">2Y</button>
                    <button class="period-btn" data-period="3y">3Y</button>
                    <button class="period-btn" data-period="5y">5Y</button>
                    <button class="period-btn" data-period="custom">Custom</button>
                </div>
                <div class="date-inputs" style="display: none;">
                    <input type="date" class="form-input" id="startDate" style="margin-bottom: 0.5rem;">
                    <input type="date" class="form-input" id="endDate">
                </div>
            </div>

            <!-- Risk Management -->
            <div class="form-group">
                <label class="form-label">Risk Management (자동)</label>
                <div class="risk-status">
                    <div class="risk-indicator" id="riskIndicator">
                        <div class="risk-level safe" id="riskLevel">
                            <i class="fas fa-shield-alt"></i>
                            <span>안전</span>
                        </div>
                        <div class="risk-value" id="riskValue">Low Risk</div>
                    </div>
                    <div class="risk-metrics">
                        <div class="metric-item">
                            <span class="metric-label">최대 레버리지</span>
                            <span class="metric-value" id="maxLeverage">5x</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">포지션 크기</span>
                            <span class="metric-value" id="positionSize">2%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Stop Loss</span>
                            <span class="metric-value" id="stopLoss">-1.5%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Initial Capital -->
            <div class="form-group">
                <label class="form-label">초기 자본 (USDT)</label>
                <div class="capital-input">
                    <input type="number" class="form-input" id="capitalAmount" value="10000" min="1000" style="width: 100%;">
                </div>
                <div class="capital-presets">
                    <button class="capital-preset" data-amount="1000">1K USDT</button>
                    <button class="capital-preset" data-amount="5000">5K USDT</button>
                    <button class="capital-preset" data-amount="10000">10K USDT</button>
                    <button class="capital-preset" data-amount="50000">50K USDT</button>
                    <button class="capital-preset" data-amount="100000">100K USDT</button>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="form-group">
                <label class="form-label">Risk Management</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                    <input type="number" class="form-input" placeholder="Max Risk %" value="2" min="0.1" max="10" step="0.1">
                    <input type="number" class="form-input" placeholder="Stop Loss %" value="5" min="1" max="20" step="0.5">
                </div>
            </div>

            <!-- Progress -->
            <div class="progress-container" style="display: none;" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Initializing...</div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="runBacktest">
                    <i class="fas fa-play"></i>
                    Run Backtest
                </button>
                <button class="btn btn-secondary" id="resetBacktest">
                    <i class="fas fa-refresh"></i>
                    Reset
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Live Backtest Monitor -->
            <div class="backtest-monitor" id="backtestMonitor" style="display: none;">
                <div class="monitor-header">
                    <h2 class="monitor-title">
                        <i class="fas fa-chart-line monitor-icon"></i>
                        백테스트 진행 중
                    </h2>
                    <div class="monitor-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">0%</span>
                    </div>
                </div>
                
                <div class="monitor-content">
                    <div class="monitor-grid">
                        <!-- 진행 상황 -->
                        <div class="monitor-card">
                            <h3 class="monitor-card-title">
                                <i class="fas fa-tasks"></i>
                                진행 상황
                            </h3>
                            <div class="monitor-stats">
                                <div class="stat-item">
                                    <span class="stat-value" id="currentSymbol">-</span>
                                    <span class="stat-label">현재 심볼</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="processedSymbols">0</span>
                                    <span class="stat-label">처리된 심볼</span>
                                </div>
                            </div>
                        </div>

                        <!-- 실시간 성과 -->
                        <div class="monitor-card">
                            <h3 class="monitor-card-title">
                                <i class="fas fa-chart-bar"></i>
                                실시간 성과
                            </h3>
                            <div class="monitor-stats">
                                <div class="stat-item">
                                    <span class="stat-value positive" id="currentReturn">+0.0%</span>
                                    <span class="stat-label">현재 수익률</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value" id="currentTrades">0</span>
                                    <span class="stat-label">거래 횟수</span>
                                </div>
                            </div>
                        </div>

                        <!-- 거래 로그 -->
                        <div class="monitor-card monitor-logs">
                            <h3 class="monitor-card-title">
                                <i class="fas fa-list-alt"></i>
                                실시간 거래 로그
                            </h3>
                            <div class="trade-log-container" id="tradeLogContainer">
                                <div class="trade-log-empty">거래 대기 중...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 백테스트 미실행 시 메시지 -->
            <div class="no-results-message" id="noResultsMessage">
                <i class="fas fa-chart-line"></i>
                <h3>백테스트를 실행해주세요</h3>
                <p>좌측 설정을 완료하고 "Run Backtest" 버튼을 클릭하여 백테스트를 시작하세요.</p>
            </div>

            <!-- 백테스트 결과 섹션 (초기에는 숨김) -->
            <div class="backtest-results" id="backtestResults">
                <!-- Results Header -->
                <div class="results-header" id="resultsHeader">
                    <h1 class="results-title">백테스트 결과</h1>
                    <div class="results-actions">
                        <button class="results-btn" onclick="exportResults()" data-tooltip="CSV 내보내기">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="results-btn" onclick="shareResults()" data-tooltip="결과 공유">
                            <i class="fas fa-share"></i>
                        </button>
                        <button class="results-btn" onclick="saveConfiguration()" data-tooltip="설정 저장">
                            <i class="fas fa-save"></i>
                        </button>
                        <button class="results-btn" onclick="resetResults()" data-tooltip="초기화">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

            <!-- Performance Cards -->
            <div class="performance-grid">
                <div class="performance-card">
                    <div class="card-header">
                        <span class="card-title">Total Return</span>
                        <span class="card-badge badge-success">Excellent</span>
                    </div>
                    <div class="card-value" id="totalReturn">+24.7%</div>
                    <div class="card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +12.3% vs benchmark
                    </div>
                </div>

                <div class="performance-card">
                    <div class="card-header">
                        <span class="card-title">Sharpe Ratio</span>
                        <span class="card-badge badge-success">Strong</span>
                    </div>
                    <div class="card-value" id="sharpeRatio">2.34</div>
                    <div class="card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        Risk-adjusted return
                    </div>
                </div>

                <div class="performance-card">
                    <div class="card-header">
                        <span class="card-title">Max Drawdown</span>
                        <span class="card-badge badge-warning">Moderate</span>
                    </div>
                    <div class="card-value" id="maxDrawdown">-8.2%</div>
                    <div class="card-change negative">
                        <i class="fas fa-arrow-down"></i>
                        Peak to trough
                    </div>
                </div>

                <div class="performance-card">
                    <div class="card-header">
                        <span class="card-title">Win Rate</span>
                        <span class="card-badge badge-success">High</span>
                    </div>
                    <div class="card-value" id="winRate">67.8%</div>
                    <div class="card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        456 / 673 trades
                    </div>
                </div>

                <div class="performance-card">
                    <div class="card-header">
                        <span class="card-title">Profit Factor</span>
                        <span class="card-badge badge-success">Excellent</span>
                    </div>
                    <div class="card-value" id="profitFactor">1.89</div>
                    <div class="card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        Gross profit/loss
                    </div>
                </div>

                <div class="performance-card">
                    <div class="card-header">
                        <span class="card-title">Annual Return</span>
                        <span class="card-badge badge-success">Strong</span>
                    </div>
                    <div class="card-value" id="annualReturn">18.6%</div>
                    <div class="card-change positive">
                        <i class="fas fa-arrow-up"></i>
                        Compounded annual
                    </div>
                </div>
            </div>

            <!-- Compact Performance Chart -->
            <div class="chart-container compact-chart" style="height: 300px;">
                <div class="chart-header">
                    <h3 class="chart-title">수익 곡선</h3>
                    <div class="chart-controls">
                        <button class="chart-btn active" data-period="1D">1일</button>
                        <button class="chart-btn" data-period="1W">1주</button>
                        <button class="chart-btn" data-period="1M">1월</button>
                        <button class="chart-btn" data-period="ALL">전체</button>
                    </div>
                </div>
                <canvas id="equityChart" style="height: 220px;"></canvas>
            </div>

            <!-- Strategy Comparison -->
            <div class="comparison-table">
                <div class="table-header">
                    <h3 class="table-title">Strategy Performance Comparison</h3>
                </div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Strategy</th>
                                <th>Return</th>
                                <th>Sharpe</th>
                                <th>Max DD</th>
                                <th>Win Rate</th>
                                <th>Trades</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="strategyTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                    <i class="fas fa-chart-bar" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                    <p>4전략 비교분석을 실행하여 결과를 확인하세요</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            </div> <!-- backtest-results 닫기 -->
        </div>
    </div>

    <script>
        // Global variables
        let equityChart = null;
        let isRunning = false;
        let allSymbols = [];
        let selectedSymbols = [];
        let isDropdownOpen = false;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeUI();
            setupEventListeners();
            initializeChart();
        });

        function initializeUI() {
            // Set default dates
            const today = new Date();
            const twoYearsAgo = new Date();
            twoYearsAgo.setFullYear(today.getFullYear() - 2);
            
            document.getElementById('startDate').value = twoYearsAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // 심볼 목록 로드
            loadSymbols();
            
            // Risk Management 초기화
            updateRiskManagement();
        }

        async function loadSymbols() {
            try {
                // 바이낸스 선물 API에서 직접 심볼 목록 가져오기
                const response = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
                const data = await response.json();
                
                if (data && data.symbols) {
                    // USDT 영구 선물만 필터링
                    const usdtPerpetuals = data.symbols
                        .filter(symbol => 
                            symbol.symbol.endsWith('USDT') && 
                            symbol.status === 'TRADING' &&
                            symbol.contractType === 'PERPETUAL'
                        )
                        .map(symbol => ({
                            symbol: symbol.symbol,
                            name: symbol.symbol.replace('USDT', ''),
                            description: `${symbol.symbol.replace('USDT', '')}/USDT 영구선물`
                        }))
                        .sort((a, b) => a.symbol.localeCompare(b.symbol));
                    
                    allSymbols = usdtPerpetuals;
                    console.log(`로드된 USDT 영구선물 심볼: ${allSymbols.length}개`);
                    renderSymbolList();
                } else {
                    throw new Error('바이낸스 API 응답 형식 오류');
                }
            } catch (error) {
                console.error('바이낸스 심볼 로드 실패:', error);
                // API 백업으로 시도
                try {
                    const backupResponse = await fetch('/api/binance/symbols');
                    const backupData = await backupResponse.json();
                    
                    if (backupData.status === 'success' && backupData.data) {
                        allSymbols = backupData.data.map(symbol => ({
                            symbol: symbol,
                            name: symbol.replace('USDT', ''),
                            description: `${symbol.replace('USDT', '')}/USDT 선물`
                        }));
                        renderSymbolList();
                    } else {
                        throw new Error('백업 API도 실패');
                    }
                } catch (backupError) {
                    console.error('백업 API도 실패:', backupError);
                    document.getElementById('symbolList').innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>심볼 목록을 불러올 수 없습니다</p>
                            <p style="font-size: 0.875rem;">네트워크 연결을 확인해주세요</p>
                        </div>
                    `;
                }
            }
        }

        function renderSymbolList(filteredSymbols = null) {
            const symbolList = document.getElementById('symbolList');
            const symbols = filteredSymbols || allSymbols;
            
            if (symbols.length === 0) {
                symbolList.innerHTML = '<div class="loading-symbols">검색 결과가 없습니다</div>';
                return;
            }
            
            symbolList.innerHTML = symbols.map(symbolData => `
                <div class="symbol-item" data-symbol="${symbolData.symbol}">
                    <div class="symbol-checkbox ${selectedSymbols.includes(symbolData.symbol) ? 'checked' : ''}" 
                         data-symbol="${symbolData.symbol}"></div>
                    <div class="symbol-text">
                        <div class="symbol-name">${symbolData.symbol}</div>
                        <div class="symbol-description">${symbolData.description}</div>
                    </div>
                </div>
            `).join('');
            
            // 이벤트 리스너 추가
            symbolList.querySelectorAll('.symbol-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const symbol = e.currentTarget.dataset.symbol;
                    toggleSymbolSelection(symbol);
                });
            });
        }

        function toggleSymbolSelection(symbol) {
            const index = selectedSymbols.indexOf(symbol);
            
            if (index > -1) {
                selectedSymbols.splice(index, 1);
            } else {
                selectedSymbols.push(symbol);
            }
            
            updateSelectedSymbolsDisplay();
            renderSymbolList(); // 체크박스 상태 업데이트를 위해 재렌더링
            updateRiskManagement(); // 리스크 관리 업데이트
        }

        function updateSelectedSymbolsDisplay() {
            const trigger = document.getElementById('symbolDropdownTrigger');
            const selectedText = trigger.querySelector('.selected-text');
            const symbolCount = document.getElementById('symbolCount');
            
            if (selectedSymbols.length === 0) {
                selectedText.textContent = '클릭하여 심볼 선택';
            } else if (selectedSymbols.length === 1) {
                selectedText.textContent = selectedSymbols[0];
            } else if (selectedSymbols.length <= 3) {
                selectedText.textContent = selectedSymbols.join(', ');
            } else {
                selectedText.textContent = `${selectedSymbols.slice(0, 2).join(', ')} 외 ${selectedSymbols.length - 2}개`;
            }
            
            symbolCount.textContent = selectedSymbols.length;
        }

        function toggleDropdown() {
            const trigger = document.getElementById('symbolDropdownTrigger');
            const menu = document.getElementById('symbolDropdownMenu');
            
            isDropdownOpen = !isDropdownOpen;
            
            if (isDropdownOpen) {
                trigger.classList.add('active');
                menu.style.display = 'block';
            } else {
                trigger.classList.remove('active');
                menu.style.display = 'none';
            }
        }

        function closeDropdown() {
            const trigger = document.getElementById('symbolDropdownTrigger');
            const menu = document.getElementById('symbolDropdownMenu');
            
            isDropdownOpen = false;
            trigger.classList.remove('active');
            menu.style.display = 'none';
        }

        function updateRiskManagement() {
            // 선택된 심볼 수와 자본금에 따른 동적 리스크 관리
            const capital = parseFloat(document.getElementById('capitalAmount')?.value) || 10000;
            const symbolCount = selectedSymbols.length || 1;
            
            // 리스크 레벨 계산
            let riskLevel, riskValue, maxLeverage, positionSize, stopLoss;
            
            if (capital >= 50000 && symbolCount <= 3) {
                // 고자본 + 적은 심볼 = 안전
                riskLevel = 'safe';
                riskValue = 'Low Risk';
                maxLeverage = '10x';
                positionSize = '3%';
                stopLoss = '-2%';
            } else if (capital >= 20000 && symbolCount <= 5) {
                // 중자본 + 보통 심볼 = 보통
                riskLevel = 'moderate';
                riskValue = 'Medium Risk';
                maxLeverage = '7x';
                positionSize = '2.5%';
                stopLoss = '-1.8%';
            } else if (capital >= 10000) {
                // 기본
                riskLevel = 'safe';
                riskValue = 'Low Risk';
                maxLeverage = '5x';
                positionSize = '2%';
                stopLoss = '-1.5%';
            } else {
                // 저자본 = 고위험
                riskLevel = 'high';
                riskValue = 'High Risk';
                maxLeverage = '3x';
                positionSize = '1.5%';
                stopLoss = '-1%';
            }
            
            // UI 업데이트
            const riskLevelElement = document.getElementById('riskLevel');
            const riskValueElement = document.getElementById('riskValue');
            const maxLeverageElement = document.getElementById('maxLeverage');
            const positionSizeElement = document.getElementById('positionSize');
            const stopLossElement = document.getElementById('stopLoss');
            
            if (riskLevelElement) {
                riskLevelElement.className = `risk-level ${riskLevel}`;
                riskLevelElement.innerHTML = `
                    <i class="fas fa-shield-alt"></i>
                    <span>${riskLevel === 'safe' ? '안전' : riskLevel === 'moderate' ? '보통' : '위험'}</span>
                `;
            }
            
            if (riskValueElement) riskValueElement.textContent = riskValue;
            if (maxLeverageElement) maxLeverageElement.textContent = maxLeverage;
            if (positionSizeElement) positionSizeElement.textContent = positionSize;
            if (stopLossElement) stopLossElement.textContent = stopLoss;
        }

        function setupEventListeners() {
            // Strategy mode toggle
            document.querySelectorAll('.strategy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const mode = this.dataset.mode;
                    const symbolGroup = document.getElementById('symbolGroup');
                    
                    if (mode === 'all') {
                        symbolGroup.style.display = 'none';
                    } else {
                        symbolGroup.style.display = 'block';
                    }
                });
            });

            // Period selector
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const period = this.dataset.period;
                    const dateInputs = document.querySelector('.date-inputs');
                    
                    if (period === 'custom') {
                        dateInputs.style.display = 'block';
                        // Custom 선택 시 기본 1달 설정
                        setDateRange('1m');
                    } else {
                        dateInputs.style.display = 'none';
                        setDateRange(period);
                    }
                });
            });

            // Capital presets
            document.querySelectorAll('.capital-preset').forEach(btn => {
                btn.addEventListener('click', function() {
                    const amount = this.dataset.amount;
                    document.getElementById('capitalAmount').value = amount;
                    updateRiskManagement();
                });
            });

            // Capital amount change
            document.getElementById('capitalAmount').addEventListener('input', updateRiskManagement);

            // Run backtest
            document.getElementById('runBacktest').addEventListener('click', runBacktest);
            
            // Reset backtest
            document.getElementById('resetBacktest').addEventListener('click', resetBacktest);

            // Chart controls
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateChartTimeframe(this.dataset.period);
                });
            });

            // 심볼 드롭다운 이벤트 리스너
            document.getElementById('symbolDropdownTrigger').addEventListener('click', toggleDropdown);

            // 전체 선택/해제 버튼
            document.getElementById('selectAllBtn').addEventListener('click', () => {
                selectedSymbols = [...allSymbols.map(s => s.symbol)];
                updateSelectedSymbolsDisplay();
                renderSymbolList();
                updateRiskManagement();
            });

            document.getElementById('clearAllBtn').addEventListener('click', () => {
                selectedSymbols = [];
                updateSelectedSymbolsDisplay();
                renderSymbolList();
                updateRiskManagement();
            });

            // 전략 선택 관련 이벤트 리스너
            document.getElementById('selectAllStrategies').addEventListener('click', () => {
                document.querySelectorAll('.strategy-checkbox').forEach(cb => cb.checked = true);
            });

            document.getElementById('clearAllStrategies').addEventListener('click', () => {
                document.querySelectorAll('.strategy-checkbox').forEach(cb => cb.checked = false);
            });

            // 4전략 비교분석 버튼
            document.getElementById('runComparisonBtn').addEventListener('click', runStrategyComparison);

            // 심볼 검색
            document.getElementById('symbolSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm === '') {
                    renderSymbolList();
                } else {
                    const filtered = allSymbols.filter(symbol => 
                        symbol.symbol.toLowerCase().includes(searchTerm) ||
                        symbol.name.toLowerCase().includes(searchTerm)
                    );
                    renderSymbolList(filtered);
                }
            });

            // 드롭다운 외부 클릭 시 닫기
            document.addEventListener('click', (e) => {
                const container = document.querySelector('.symbol-dropdown-container');
                if (!container.contains(e.target) && isDropdownOpen) {
                    closeDropdown();
                }
            });
        }

        function setDateRange(period) {
            const today = new Date();
            const startDate = new Date();
            
            switch(period) {
                case '1m':
                    startDate.setMonth(today.getMonth() - 1);
                    break;
                case '6m':
                    startDate.setMonth(today.getMonth() - 6);
                    break;
                case '1y':
                    startDate.setFullYear(today.getFullYear() - 1);
                    break;
                case '2y':
                    startDate.setFullYear(today.getFullYear() - 2);
                    break;
                case '3y':
                    startDate.setFullYear(today.getFullYear() - 3);
                    break;
                case '5y':
                    startDate.setFullYear(today.getFullYear() - 5);
                    break;
            }
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        }

        async function initializeChart() {
            const ctx = document.getElementById('equityChart').getContext('2d');
            
            // 차트 초기화 - 빈 데이터로 시작 (백테스트 실행 전까지 숨김)
            const data = { labels: [], values: [], benchmark: [] };
            
            equityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Portfolio Value',
                        data: data.values,
                        borderColor: '#0066FF',
                        backgroundColor: 'rgba(0, 102, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Benchmark',
                        data: data.benchmark,
                        borderColor: '#8B8FA3',
                        backgroundColor: 'transparent',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#FFFFFF',
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            grid: {
                                color: '#3A3F5C'
                            },
                            ticks: {
                                color: '#8B8FA3'
                            }
                        },
                        y: {
                            grid: {
                                color: '#3A3F5C'
                            },
                            ticks: {
                                color: '#8B8FA3',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        async function generateRealEquityCurve() {
            try {
                // 실제 백테스트 결과 가져오기
                const response = await fetch('/api/backtest/results');
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const latestResult = data.results[data.results.length - 1];
                    
                    const labels = [];
                    const values = [];
                    const benchmark = [];
                    
                    if (latestResult.trade_log && latestResult.trade_log.length > 0) {
                        let portfolioValue = latestResult.initial_capital;
                        let benchmarkValue = latestResult.initial_capital;
                        
                        labels.push(new Date(latestResult.start_date));
                        values.push(portfolioValue);
                        benchmark.push(benchmarkValue);
                        
                        latestResult.trade_log.forEach(trade => {
                            if (trade.pnl) {
                                portfolioValue += trade.pnl;
                            }
                            
                            labels.push(new Date(trade.timestamp));
                            values.push(portfolioValue);
                            
                            // 벤치마크는 동일 기간 시장 평균 수익률로 계산
                            const daysDiff = Math.floor((new Date(trade.timestamp) - new Date(latestResult.start_date)) / (1000 * 60 * 60 * 24));
                            benchmarkValue = latestResult.initial_capital * Math.pow(1.08, daysDiff / 365); // 연 8% 가정
                            benchmark.push(benchmarkValue);
                        });
                    }
                    
                    return { labels, values, benchmark };
                }
            } catch (error) {
                console.error('백테스트 결과 조회 실패:', error);
            }
            
            // 백테스트 데이터가 없으면 빈 데이터 반환
            return { labels: [], values: [], benchmark: [] };
        }

        async function runBacktest() {
            if (isRunning) return;
            
            isRunning = true;
            const btn = document.getElementById('runBacktest');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            // 선택된 전략들 수집
            const selectedStrategies = Array.from(document.querySelectorAll('.strategy-checkbox:checked'))
                .map(cb => cb.value);

            // 폼 데이터 수집
            const formData = {
                strategies: selectedStrategies.length > 0 ? selectedStrategies : ['strategy1_basic'],
                symbols: selectedSymbols,
                initial_capital: parseFloat(document.getElementById('capitalAmount').value) || 10000,
                start_date: document.getElementById('startDate').value || '2024-01-01',
                end_date: document.getElementById('endDate').value || '2024-12-31'
            };
            
            // 유효성 검사
            if (formData.symbols.length === 0) {
                alert('최소 하나의 심볼을 선택해주세요.');
                isRunning = false;
                return;
            }
            
            if (formData.strategies.length === 0) {
                alert('최소 하나의 전략을 선택해주세요.');
                isRunning = false;
                return;
            }
            
            // UI 업데이트
            btn.innerHTML = '<div class="loading"></div> Running...';
            btn.disabled = true;
            progressContainer.style.display = 'block';
            
            try {
                // 실제 백테스트 API 호출
                const response = await fetch('/api/backtest/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error('백테스트 시작 실패');
                }
                
                const result = await response.json();
                
                // SSE로 실시간 진행률 모니터링
                const eventSource = new EventSource(`/api/backtest/stream/${result.job_id}`);
                
                eventSource.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    
                    if (data.status === 'progress') {
                        progressFill.style.width = data.progress + '%';
                        progressText.textContent = `Processing... ${Math.round(data.progress)}%`;
                        
                        if (data.message) {
                            progressText.textContent = data.message;
                        }
                    } else if (data.status === 'completed') {
                        eventSource.close();
                        
                        progressFill.style.width = '100%';
                        btn.innerHTML = '<i class="fas fa-check"></i> Complete';
                        btn.style.background = 'linear-gradient(135deg, #00D084, #00A86B)';
                        progressText.textContent = 'Backtest completed successfully!';
                        
                        // 결과 업데이트
                        updateBacktestResults(data.result);
                        
                        setTimeout(() => {
                            resetBacktestButton();
                        }, 2000);
                    } else if (data.status === 'error') {
                        eventSource.close();
                        throw new Error(data.message || '백테스트 실행 중 오류 발생');
                    }
                };
                
                eventSource.onerror = function(error) {
                    eventSource.close();
                    throw new Error('실시간 모니터링 연결 실패');
                };
                
            } catch (error) {
                console.error('백테스트 실행 오류:', error);
                alert('백테스트 실행에 실패했습니다: ' + error.message);
                resetBacktestButton();
            }
        }

        function resetBacktestButton() {
            const btn = document.getElementById('runBacktest');
            btn.innerHTML = '<i class="fas fa-play"></i> Run Backtest';
            btn.style.background = 'linear-gradient(135deg, #0066FF, #3D8BFF)';
            btn.disabled = false;
            document.getElementById('progressContainer').style.display = 'none';
            isRunning = false;
        }

        function resetBacktest() {
            // 결과 섹션 숨기고 초기 메시지 표시
            document.getElementById('backtestResults').classList.remove('show');
            document.getElementById('noResultsMessage').style.display = 'block';
            
            // Reset all values to defaults
            document.getElementById('totalReturn').textContent = '+0.0%';
            document.getElementById('sharpeRatio').textContent = '0.00';
            document.getElementById('maxDrawdown').textContent = '0.0%';
            document.getElementById('winRate').textContent = '0.0%';
            document.getElementById('profitFactor').textContent = '0.00';
            document.getElementById('annualReturn').textContent = '0.0%';
            
            // 차트 초기화
            if (equityChart) {
                equityChart.data.labels = [];
                equityChart.data.datasets[0].data = [];
                equityChart.data.datasets[1].data = [];
                equityChart.update();
            }
            
            resetBacktestButton();
        }

        function updateChartTimeframe(period) {
            // Update chart based on selected timeframe
            // This would typically filter the data
            console.log('Updating chart for period:', period);
        }

        async function runStrategyComparison() {
            if (isRunning) return;
            
            const selectedStrategies = Array.from(document.querySelectorAll('.strategy-checkbox:checked'))
                .map(cb => cb.value);
            
            if (selectedStrategies.length === 0) {
                alert('비교할 전략을 최소 1개 이상 선택해주세요.');
                return;
            }
            
            if (selectedSymbols.length === 0) {
                alert('백테스트할 심볼을 선택해주세요.');
                return;
            }
            
            isRunning = true;
            const btn = document.getElementById('runComparisonBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="loading"></div> 비교분석 중...';
            btn.disabled = true;
            
            try {
                // 각 전략별로 백테스트 실행
                const comparisonResults = [];
                
                for (const strategy of selectedStrategies) {
                    const formData = {
                        strategies: [strategy],
                        symbols: selectedSymbols,
                        initial_capital: parseFloat(document.getElementById('capitalAmount').value) || 10000,
                        start_date: document.getElementById('startDate').value || '2024-01-01',
                        end_date: document.getElementById('endDate').value || '2024-12-31'
                    };
                    
                    const response = await fetch('/api/backtest/start', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        comparisonResults.push({
                            strategy: strategy,
                            result: result
                        });
                    }
                }
                
                // 비교 결과 표시
                displayStrategyComparison(comparisonResults);
                
                btn.innerHTML = '<i class="fas fa-check"></i> 분석 완료';
                btn.style.background = 'linear-gradient(135deg, #00D084, #00A86B)';
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                    btn.disabled = false;
                    isRunning = false;
                }, 3000);
                
            } catch (error) {
                console.error('전략 비교분석 실패:', error);
                alert('전략 비교분석 중 오류가 발생했습니다: ' + error.message);
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                isRunning = false;
            }
        }

        function displayStrategyComparison(results) {
            // 결과 섹션 표시
            document.getElementById('noResultsMessage').style.display = 'none';
            document.getElementById('backtestResults').classList.add('show');
            
            // 비교 테이블 업데이트
            const tableBody = document.getElementById('strategyTableBody');
            
            // 테이블 초기화 - 기존 더미 데이터 완전 제거
            tableBody.innerHTML = '';
            
            if (results.length > 0) {
                tableBody.innerHTML = results.map((item, index) => {
                    // API 응답 구조에 맞게 데이터 추출
                    const result = item.result?.data || item.result || {};
                    
                    // 백테스트 결과가 실제로 있는지 확인
                    const hasValidResults = result.total_return !== undefined || result.final_value !== undefined;
                    
                    if (!hasValidResults) {
                        return `
                            <tr>
                                <td>
                                    <div class="strategy-name">
                                        <div class="strategy-icon" style="background: ${getStrategyColor(index)};"></div>
                                        ${getStrategyDisplayName(item.strategy)}
                                    </div>
                                </td>
                                <td colspan="6" style="text-align: center; color: var(--text-muted);">
                                    백테스트 실행 실패 또는 데이터 없음
                                </td>
                            </tr>
                        `;
                    }
                    
                    return `
                        <tr>
                            <td>
                                <div class="strategy-name">
                                    <div class="strategy-icon" style="background: ${getStrategyColor(index)};"></div>
                                    ${getStrategyDisplayName(item.strategy)}
                                </div>
                            </td>
                            <td><span class="metric-value positive">+${(result.total_return * 100 || 0).toFixed(1)}%</span></td>
                            <td><span class="metric-value">${(result.sharpe_ratio || 0).toFixed(2)}</span></td>
                            <td><span class="metric-value negative">${(result.max_drawdown * 100 || 0).toFixed(1)}%</span></td>
                            <td><span class="metric-value">${(result.win_rate * 100 || 0).toFixed(1)}%</span></td>
                            <td><span class="metric-value">${result.total_trades || 0}</span></td>
                            <td><span class="card-badge badge-success">Complete</span></td>
                        </tr>
                    `;
                }).join('');
            } else {
                // 결과가 없을 때 초기 상태로 복원
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p>전략 비교분석 결과가 없습니다</p>
                        </td>
                    </tr>
                `;
            }
        }

        function getStrategyColor(index) {
            const colors = ['#0066FF', '#00D084', '#FFB800', '#FF4757'];
            return colors[index % colors.length];
        }

        function getStrategyDisplayName(strategy) {
            const names = {
                'strategy1_basic': '전략 1 (기본)',
                'strategy1_alpha': '전략 1-1 (알파)',
                'strategy2_basic': '전략 2 (기본)',
                'strategy2_alpha': '전략 2-1 (알파)'
            };
            return names[strategy] || strategy;
        }

        function updateBacktestResults(result) {
            // 백테스트 결과 섹션 표시
            document.getElementById('noResultsMessage').style.display = 'none';
            document.getElementById('backtestResults').classList.add('show');
            
            // 백테스트 결과 UI 업데이트
            document.getElementById('totalReturn').textContent = `${(result.total_return * 100).toFixed(2)}%`;
            document.getElementById('sharpeRatio').textContent = result.sharpe_ratio.toFixed(2);
            document.getElementById('maxDrawdown').textContent = `${(result.max_drawdown * 100).toFixed(2)}%`;
            document.getElementById('winRate').textContent = `${(result.win_rate * 100).toFixed(1)}%`;
            document.getElementById('profitFactor').textContent = (result.total_trades > 0 ? (result.winning_trades / result.total_trades).toFixed(2) : '0.00');
            document.getElementById('annualReturn').textContent = `${((Math.pow(result.final_value / result.initial_capital, 365 / (new Date(result.end_date) - new Date(result.start_date)) * 365) - 1) * 100).toFixed(2)}%`;
            
            // 차트 업데이트
            updateEquityChart(result);
        }

        async function updateEquityChart(result) {
            if (!equityChart || !result.trade_log) return;
            
            const labels = [];
            const values = [];
            const benchmark = [];
            
            let portfolioValue = result.initial_capital;
            let benchmarkValue = result.initial_capital;
            
            labels.push(new Date(result.start_date));
            values.push(portfolioValue);
            benchmark.push(benchmarkValue);
            
            result.trade_log.forEach(trade => {
                if (trade.pnl) {
                    portfolioValue += trade.pnl;
                }
                
                labels.push(new Date(trade.timestamp));
                values.push(portfolioValue);
                
                // 벤치마크는 연 8% 가정
                const daysDiff = Math.floor((new Date(trade.timestamp) - new Date(result.start_date)) / (1000 * 60 * 60 * 24));
                benchmarkValue = result.initial_capital * Math.pow(1.08, daysDiff / 365);
                benchmark.push(benchmarkValue);
            });
            
            equityChart.data.labels = labels;
            equityChart.data.datasets[0].data = values;
            equityChart.data.datasets[1].data = benchmark;
            equityChart.update();
        }

        // 백테스트 실행 함수
        async function runBacktest() {
            if (isRunning) return;
            
            // 현재 모드 확인
            const activeMode = document.querySelector('.strategy-btn.active').dataset.mode;
            
            // 전략 선택 확인
            const selectedStrategies = Array.from(document.querySelectorAll('.strategy-checkbox:checked'))
                .map(cb => cb.value);
            
            if (selectedStrategies.length === 0) {
                alert('백테스트할 전략을 최소 1개 이상 선택해주세요.');
                return;
            }
            
            // 심볼 선택 확인 (개별 전략 모드일 때만)
            let symbolsToUse = [];
            if (activeMode === 'compare') {
                if (selectedSymbols.length === 0) {
                    alert('백테스트할 심볼을 선택해주세요.');
                    return;
                }
                symbolsToUse = selectedSymbols;
            } else {
                // 전체 시장 모드: 모든 심볼 사용
                symbolsToUse = allSymbols.map(s => s.symbol);
                if (symbolsToUse.length === 0) {
                    alert('심볼 목록을 불러오는 중입니다. 잠시 후 다시 시도해주세요.');
                    return;
                }
            }
            
            isRunning = true;
            const btn = document.getElementById('runBacktest');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<div class="loading"></div> 백테스트 실행 중...';
            btn.disabled = true;
            
            // 진행률 표시
            const progressContainer = document.getElementById('progressContainer');
            progressContainer.style.display = 'block';
            
            try {
                const formData = {
                    strategies: selectedStrategies,
                    symbols: symbolsToUse,
                    initial_capital: parseFloat(document.getElementById('capitalAmount').value) || 10000,
                    start_date: document.getElementById('startDate').value || '2024-01-01',
                    end_date: document.getElementById('endDate').value || '2024-12-31',
                    backtest_mode: activeMode === 'all' ? 'market_wide' : 'individual'
                };
                
                const response = await fetch('/api/backtest/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.success) {
                        // 스트리밍 로그 시작
                        if (result.stream_url) {
                            startStreamingLogs(result.stream_url);
                        }
                        
                        btn.innerHTML = '<i class="fas fa-check"></i> 백테스트 완료';
                        btn.style.background = 'linear-gradient(135deg, #00D084, #00A86B)';
                        
                        setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.style.background = '';
                            btn.disabled = false;
                            isRunning = false;
                            progressContainer.style.display = 'none';
                        }, 3000);
                    } else {
                        throw new Error(result.error || '백테스트 시작 실패');
                    }
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '서버 오류');
                }
                
            } catch (error) {
                console.error('백테스트 실행 실패:', error);
                alert('백테스트 실행에 실패했습니다: ' + error.message);
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                isRunning = false;
                progressContainer.style.display = 'none';
            }
        }

        // 스트리밍 로그 시작
        function startStreamingLogs(streamUrl) {
            const eventSource = new EventSource(streamUrl);
            const logContainer = document.getElementById('tradeLogContainer');
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'progress') {
                        updateProgress(data.progress, data.message);
                    } else if (data.type === 'log') {
                        addLogMessage(data.message);
                    } else if (data.type === 'result') {
                        updateBacktestResults(data.result);
                        eventSource.close();
                    } else if (data.type === 'error') {
                        addLogMessage('오류: ' + data.message, 'error');
                        eventSource.close();
                    }
                } catch (e) {
                    console.error('로그 파싱 오류:', e);
                }
            };
            
            eventSource.onerror = function() {
                console.error('스트리밍 연결 오류');
                eventSource.close();
            };
        }

        // 진행률 업데이트
        function updateProgress(progress, message) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = message || `진행률: ${progress}%`;
            }
        }

        // 로그 메시지 추가
        function addLogMessage(message, type = 'info') {
            const logContainer = document.getElementById('tradeLogContainer');
            const logEmpty = logContainer.querySelector('.trade-log-empty');
            
            if (logEmpty) {
                logEmpty.remove();
            }
            
            const logItem = document.createElement('div');
            logItem.className = `trade-log-item ${type}`;
            logItem.innerHTML = `
                <span class="log-time">${new Date().toLocaleTimeString()}</span>
                <span class="log-message">${message}</span>
            `;
            
            logContainer.appendChild(logItem);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // 백테스트 초기화 함수
        function resetBacktest() {
            // 결과 섹션 숨기기
            document.getElementById('backtestResults').classList.remove('show');
            document.getElementById('noResultsMessage').style.display = 'block';
            
            // 차트 초기화
            if (equityChart) {
                equityChart.data.labels = [];
                equityChart.data.datasets[0].data = [];
                equityChart.data.datasets[1].data = [];
                equityChart.update();
            }
            
            // 로그 초기화
            const logContainer = document.getElementById('tradeLogContainer');
            logContainer.innerHTML = '<div class="trade-log-empty">거래 대기 중...</div>';
            
            // 진행률 숨기기
            document.getElementById('progressContainer').style.display = 'none';
            
            // 전략 비교 테이블 초기화
            const tableBody = document.getElementById('strategyTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                        <i class="fas fa-chart-bar" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>4전략 비교분석을 실행하여 결과를 확인하세요</p>
                    </td>
                </tr>
            `;
            
            console.log('백테스트 초기화 완료');
        }
    </script>
</body>
</html>